# To get started with Dependabot version updates, you'll need to specify which
# package ecosystems to update and where the package manifests are located.
# Please see the documentation for all configuration options:
# https://docs.github.com/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file

version: 2

multi-ecosystem-groups:
  # Playwright updates are grouped across npm and Docker to keep them in sync
  playwright:
    schedule:
      interval: "weekly"

updates:
  # Playwright npm package - grouped with Docker image
  - package-ecosystem: "npm"
    directory: "/e2e"
    schedule:
      interval: "weekly"
    patterns:
      - "@playwright/test"
    multi-ecosystem-group: "playwright"

  # Other npm packages
  - package-ecosystem: "npm"
    directories:
      - "/frontend"
      - "/e2e"
    schedule:
      interval: "weekly"
    groups:
      # Minor and patch version updates for Angular dependencies are grouped into a single pull request.
      angular:
        applies-to: version-updates
        patterns:
          - "@angular/*"
          - "@angular-devkit/*"
        update-types:
          - "minor"
          - "patch"
      # Minor and patch security updates for Angular dependencies are also grouped together into a single pull request.
      angular-security-updates:
        applies-to: security-updates
        patterns:
          - "@angular/*"
          - "@angular-devkit/*"
        update-types:
          - "minor"
          - "patch"
      # Group all patch updates into a single PR to reduce noise.
      patch-updates:
        update-types:
          - "patch"

    # Dependabot won't automatically open pull requests for major updates for Angular.
    ignore:
      - dependency-name: "@angular/*"
        update-types: ["version-update:semver-major"]
      - dependency-name: "@angular-devkit/*"
        update-types: ["version-update:semver-major"]
      # Ignore playwright in this ecosystem entry since it's handled by the multi-ecosystem group
      - dependency-name: "@playwright/test"

    # other package updates will happen in individual PRs

  # Python packages
  - package-ecosystem: "pip"
    directories:
      - "/backend"
      - "/parsing"
    schedule:
      interval: "weekly"
    groups:
      python-dependencies:
        update-types:
          - "minor"
          - "patch"
    # major updates will happen in individual PRs

  # Playwright Docker image - grouped with npm package
  - package-ecosystem: "docker"
    directory: "/docker/e2e"
    schedule:
      interval: "weekly"
    patterns:
      - "mcr.microsoft.com/playwright"
    multi-ecosystem-group: "playwright"

  # Other Docker images
  - package-ecosystem: "docker"
    directories:
      - "/docker/backend"
      - "/docker/elasticsearch"
      - "/docker/proxy"
      - "/docker/e2e"
    schedule:
      interval: "weekly"
    groups:
      docker-images:
        update-types:
          - "minor"
          - "patch"
    ignore:
      # Ignore playwright in this ecosystem entry since it's handled by the multi-ecosystem group
      - dependency-name: "mcr.microsoft.com/playwright"
    # major updates will happen in individual PRs

  # Docker Compose
  - package-ecosystem: "docker-compose"
    directory: "/"
    schedule:
      interval: "weekly"
    groups:
      docker-compose:
        update-types:
          - "minor"
          - "patch"
    # major updates will happen in individual PRs

  # GitHub Actions
  - package-ecosystem: "github-actions"
    # Workflow files stored in the default location of `.github/workflows`
    # You don't need to specify `/.github/workflows` for `directory`. You can use `directory: "/"`.
    directory: "/"
    schedule:
      interval: "weekly"
    # group all GitHub Actions updates together in a single PR since they are usually small
    groups:
      github-actions:
        patterns:
          - "*"
